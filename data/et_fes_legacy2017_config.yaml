backend: classic
channels: [et]
num_threads: 1
datasets: datasets/datasets.json
binning: data/binning.yaml
binning_key: gof
era: '2017'
tag: etauFES
context_analysis: etFes
methods_collection_key: "Legacy_FES_with_QCDSStoOS" # Legacy_FES_with_EMB_QCDSStoOS ; in 2017: Original_FES_with_FF

output_file: Null  # keep it empty for auto-naming
output_file_name: Null  # keep it empty for auto-naming: context_analysis + methods_collection_key

user_specific:
  output_file_dir:
    byhost:
      default: Null
    glusheno:
      naf: /nfs/dust/cms/user/glusheno/shapes/FES/shapes/ET
    ohlushch:
      bms: /ceph/ohlushch/shapes/FES/shapes/ET

  ## Path to inputs with nominal pipeline and systematics
  ## Note: shared samples should Not be used in the FES subanalysis since those contain the old FES corrections
  directory:
    byhost:
      default: Null
      naf:
        '2017': /nfs/dust/cms/group/higgs-kit/Legacy/FES/FESshifts_2017/merged/
      bms:
        '2017': /ceph/ohlushch/naf/FES/ETauFakeES_Legacy_v2/FESshifts_2017/merged_nominal
        '2018': /ceph/ohlushch/naf/FES/ETauFakeES_Legacy_v2/FESshifts_2018/merged_nominal
    glusheno:
      naf: /nfs/dust/cms/group/higgs-kit/Legacy/FES/FESshifts_2017/merged/
    #TODO: check on how to use $ARTUS_OUTPUTS_2017 and shifts with common friends
    ohlushch:
      bms:
        '2017': /ceph/ohlushch/naf/FES/ETauFakeES_Legacy_v2/FESshifts_2017/merged_nominal #"$ARTUS_OUTPUTS_2017"
        '2018': /ceph/ohlushch/naf/FES/ETauFakeES_Legacy_v2/FESshifts_2018/merged_nominal

  et_friend_directory:
    byhost:
      default: []
  mt_friend_directory:
    byhost:
      default: []
  tt_friend_directory:
    byhost:
      default: []
  fake_factor_friend_directory:
    byhost:
      default: ["$ARTUS_FRIENDS_FAKE_FACTOR_INCL_2017"]

  ## FES shifts pipelines should be stored separatelys
  fes_friend_directory:
    byhost:
      default: []
      bms:
        '2017': ["/ceph/ohlushch/naf/FES/ETauFakeES_Legacy_v2/FESshifts_2017/merged_shifts"]  # "/ceph/ohlushch/naf/FES/FES/FESshifts_2017/merged/"

# et_friend_directory: ''
# mt_friend_directory: ''
# tt_friend_directory: ''
# fake_factor_friend_directory: "$ARTUS_FRIENDS_FAKE_FACTOR_INCL_2017"
# fes_friend_directory: "/ceph/ohlushch/naf/FES/FES/FESshifts_2017/merged/"

skip_systematic_variations: False
variables_names: [
  # m_1, m_2,
  # mt_1, mt_2,
  # pt_1, pt_2,
  # eta_1, eta_2,
  # jpt_1, jpt_2,
  # jeta_1, jeta_2,
  # decayMode_1, decayMode_2,
  # iso_1, iso_2,
  # d0_1, d0_2,
  # dZ_1, dZ_2
  m_vis,
  # njets,
  # mt_tot,
  # # ptvis,
  # # npv,
  # njets,
  # nbtag,
  # met,
  # mjj,
  # dijetpt,
  # pZetaMissVis,
  # rho,
]

## Cuts enabling
update_process_per_category: False
no_fes_extra_cuts: False
no_et_minplotlev_cuts: True  # do not re-apply minplotlevel cuts
no_mt_minplotlev_cuts: True  # do not re-apply minplotlevel cuts
no_force_cuts: False  # forcing
no_extra_cuts: False  # disabling all below mentioned cuts

## Cuts definitions
fes_extra_cuts: {}  # Cuts applied to FES pipelines
# applied to all pipelines! # minimal plot level cuts ; might be not callable with smHtt samples
et_minplotlev_cuts:
  'nDiElectronVetoPairsOS': 'nDiElectronVetoPairsOS < 0.5'
  'extraelec_veto': 'extraelec_veto < 0.5'
  'extramuon_veto': 'extramuon_veto < 0.5'
# applied to all pipelines! Here a global difference between master shapes and FES selection should be made
force_cuts:
  'dilepton_veto': Null  # removes the cut; to enhance Z->ee; it need at artus minimalplotlevfilter nDiElectronVetoPairsOS cut to be disabled
  #
  # Was used before but not necessary to be kept
  # "mt_1" : "mt_1<70"
  # "tau_iso": 'byLooseIsolationMVArun2017v2DBoldDMwLT2017_2 > 0.5' # to enhance Z->ee, I think it wasn't used in the last iteration, for it the new FF have to be recalculated...
  #
  # Completely obsolete:
  # 'trg_selection': "(trg_singleelectron_27 == 1) || (trg_singleelectron_32 == 1) || (trg_singleelectron_35) || (trg_crossele_ele24tau30 == 1) || (isEmbedded && pt_1>20 && pt_1<24)"  # used at 2017
# Invert cuts if present
invert_cuts: [] # Cuts to be inverted. Applied prior the force-cuts and don't affect them.

## Processed is the intersection with list from _known_estimation_methods
shifts: [
  nominal,
  # TES,
  # EMB,
  FES_shifts,
  # Zpt,
]

grid_categories:

  eta_1_region: [
    'inc_eta_1',
    'eta_1_barel',
    'eta_1_endcap',
    'eta_1_endcap_real',
  ]

  decay_mode: [
    'alldm',
    'dm0',
    'dm1',
    # 'dm10', # for FES is not interesting
  ]

  jets_multiplicity: [
    'njetN',
    'njet0',
  ]

single_categories: {
  # a:
  #   'nDiElectronVetoPairsOS': 'nDiElectronVetoPairsOS < 0.5'
  #   'extraelec_veto': 'extraelec_veto < 0.5'
  #   'extramuon_veto': 'extramuon_veto < 0.5'
}

etau_es_shifts: [
            -4, -3, -2, -1.75, -1.5, -1.25, -1, -0.75, -0.5, -0.25,
            0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5,
            2.75, 3, 3.25, 3.5, 3.75, 4, 5, 6, 7, 8,
            9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        ]

